image: nexus.itecos.com:5000/java-app:15

variables:
  GIT_DEPTH: 40
  PROD_NAMESPACE: "k24cluster"
  # конфиг kubectl, завернутый в base64, внутрь которого встроены все сертификаты и ключи
  KUBE_CONFIG: YXBpVmVyc2lvbjogdjEKY2x1c3RlcnM6Ci0gY2x1c3RlcjoKICAgIGNlcnRpZmljYXRlLWF1dGhvcml0eS1kYXRhOiBMUzB0TFMxQ1JVZEpUaUJEUlZKVVNVWkpRMEZVUlMwdExTMHRDazFKU1VNNWVrTkRRV1FyWjBGM1NVSkJaMGxLUVUxRVJHNHJVMHBvYjFselRVRXdSME5UY1VkVFNXSXpSRkZGUWtOM1ZVRk5Ra2w0UlVSQlQwSm5UbFlLUWtGTlRVSXlkREZaYlZWMFdUSkZkMGhvWTA1TlZHZDNUVlJKTTAxRWEzZE5SRkV5VjJoalRrNUVWWGRPYWtVd1RVUnJkMDFFVVRKWGFrRlRUVkpCZHdwRVoxbEVWbEZSUkVSQlpISmtWMHBzVEZkT2FFMUpTVUpKYWtGT1FtZHJjV2hyYVVjNWR6QkNRVkZGUmtGQlQwTkJVVGhCVFVsSlFrTm5TME5CVVVWQkNuZFRhME5LWm14MlQyazJTa0Z5YUhsa1drNUxjbXc0THpoaVJIQk1hVzFOTTNkNGJqRkxNbFJCUlhFcmNHTXhLelJTVG5CRE9HMXFZbWRvU0doc2RYSUtZbFZhWmtGUVZubHpXa2RSU214NVdsaFdhSEl3T0V0T1dGVnFSREV6TTJGcEswNTBhalV3YW5OTE4xZHJUbkIxTmtveFZHcFdjMG9yZFhsMlVtMXdOd3BJUjJZMFVtZHBkMDFVVmt4MVRXUXJka3QxVm1NM1IwRnZlU3RzUzJZd01ERlBjV294TlhsaWIzVnpUR2h3Wm5sc2FtMUNXakJZUjFwTVJtTTBOWHB3Q2xWSmNrdGlSMmhOUVZCRlFVOWpWV2hLUkZwV1NERmpSbmw1YjB0UFYxUXdjRGxLUjJ0UWFXSk9hWEZsYzNneVEzTnlUSGhGWTJWS00ySm1MMHAxU1hjS1RrbE9MekJ1Y21KNmNVaElOazUyUTNoV1ltNTFOMlJEUzNJeldXcDRTa2hqYURnclQxUm5NWGxSVVhkT1NXODBjVlJGVEd0bFJrRlJkbVZ6TXk4MWJ3cDZRalE1VVV4T2VWQkdXbk4zUlRZeWRISjNNMUpSU1VSQlVVRkNiekZCZDFScVFXUkNaMDVXU0ZFMFJVWm5VVlYxZGpOb2NGTlBZMWRuUTJKbmJITlVDbEV4ZFRsWVZGVTVka3M0ZDBoM1dVUldVakJxUWtKbmQwWnZRVlYxZGpOb2NGTlBZMWRuUTJKbmJITlVVVEYxT1ZoVVZUbDJTemgzUkVGWlJGWlNNRlFLUWtGVmQwRjNSVUl2ZWtGT1FtZHJjV2hyYVVjNWR6QkNRVkZ6UmtGQlQwTkJVVVZCZFZsaFJqbHdTR2hMVGtaemFVWjNlVWhXT1V4WlZrRlBOVGt4U1FvdlJHZGxWM0pCWVZGbFdUWlpNalZ3TTFOMk16ZzBha0ZTVDB4V1ozTTRUMUI1YVhwSU1XUjZOMDFLZEV4QlpGcFhUWFpXTXpSMFNqTnVZMXBJUW5GMUNqSnpRV3RQUVhsYVJVbHdUbkJQU3psRVlXaFhZMWs1WmxaNlVXSkdWMFZqVmxKMWVVRXhRMjlHTVRGR2FVUnROMFJPUlhsUFQyOUtOSFJyYlhGU2RHc0tOak5JWVhaM2FHbDZTV2R1TWxNdllWcDVZMmhJTkRCV2JGRlNXakpQUVdSNVpFcDJlRkppZVdWa05ESk9VSGN3VmtkVk9XWTBUbUVyYW1WTVlTdGtUZ3BHTm5OTFluWlVSSGRvVldSdFlsQlBORXQzVUhOaFFWUm5hMWxqTDFJeFdIcFRiREZuZEVWNFFtRTFWWE1yZWxOc2RUbEpWM0ZTZGpOUlNsVlFTalJvQ21scVJGbFlXa2RrY1ROR2NHTkRSMVJzTVRWaFJ6VmpWMWw0Y2pkVlZtazFVR3BOWm1waWVtUjZVME5oZURrMFFuQlRjMDk0YkRGSGNGRTlQUW90TFMwdExVVk9SQ0JEUlZKVVNVWkpRMEZVUlMwdExTMHRDZz09CiAgICBzZXJ2ZXI6IGh0dHBzOi8vMTAuMjU1LjYzLjQxCiAgbmFtZTogaW5mcmEKLSBjbHVzdGVyOgogICAgY2VydGlmaWNhdGUtYXV0aG9yaXR5LWRhdGE6IExTMHRMUzFDUlVkSlRpQkRSVkpVU1VaSlEwRlVSUzB0TFMwdENrMUpTVU01ZWtORFFXUXJaMEYzU1VKQlowbEtRVTFSVERkaFQwVkVUVmRJVFVFd1IwTlRjVWRUU1dJelJGRkZRa04zVlVGTlFrbDRSVVJCVDBKblRsWUtRa0ZOVFVJeWRERlpiVlYwV1RKRmQwaG9ZMDVOVkdkM1RYcEJORTFFWjNkTlZGRXdWMmhqVGs1RVZYZE9la2t3VFVSbmQwMVVVVEJYYWtGVFRWSkJkd3BFWjFsRVZsRlJSRVJCWkhKa1YwcHNURmRPYUUxSlNVSkpha0ZPUW1kcmNXaHJhVWM1ZHpCQ1FWRkZSa0ZCVDBOQlVUaEJUVWxKUWtOblMwTkJVVVZCQ2pFdkwxWldkMFpWZDJNeVNXTndURlp6TkhZd09HZE1VWFJ5VHpSQ1pUVnhORkk1U3pKemJsQTROMVpPYzBFMlN6RnRRV3AxTm14U1NWQmpSMmx4UkhrS1ZXOXBkVXBSTVRkTGMyTm9iM0IzYTFZeU5tTlFXR1JIWVdGdFV6WldaVmRTU21jMlVXTktTMnRuWlcxV00yOW1hbVZOV0docmMyWTRjVmRGT0hGeE1RcDFlbk5hTURkNmF6QXlZMmRQY1N0MWJXNU5lamRCVFZaNVFtZzFUVWhpWkd4bFJIUmlUbk5xUlVOSU9XRkdSeTlKTjJSUGNHb3pWa3ByZFV4dlFYTmlDa1pJUWxwS2RsSndjVkZQY0VaaU4wSm1SMmc1TjA0clVVRm1abVJpTkRkUWFIUmxSRXAxVFM5UFQzSmFXV0ZNUjJOcWJEbHVjMWR1WTNKVk5XWkVVelFLZEhocFpXSk5hR0pNTVhGV2VWSnRNMGt2WlZGVVpXd3laMFJNZUVGRGNHczVTRFJDY2xKcWFtSXdOMGRqVWxaSkt6RjFjbk5uVTNSS05GSmxWbk0xY2dwUlQweHlMM0ZpTVRSS2FVaHpabFowYUVOeE5rVlJTVVJCVVVGQ2J6RkJkMVJxUVdSQ1owNVdTRkUwUlVablVWVjJUalZsVFVocmNEZFlhV3RVUVhnMkNsaGxSQ3RZYzBSc2RuQjNkMGgzV1VSV1VqQnFRa0puZDBadlFWVjJUalZsVFVocmNEZFlhV3RVUVhnMldHVkVLMWh6Ukd4MmNIZDNSRUZaUkZaU01GUUtRa0ZWZDBGM1JVSXZla0ZPUW1kcmNXaHJhVWM1ZHpCQ1FWRnpSa0ZCVDBOQlVVVkJaekphVjNCdEsyTnpXbFozWkVFM1RrZ3paemw1ZVhORGNUSmFhUXBUTVU5VmMzbG5TbnBoTkM4NVl6SldNRWhoTjFCMk5rSnVlVFoxTkRWRGFGUk1WMFpQVTFRelVWTjFaVXd5ZVZWQ1FscFZabTUzZVN0RWNGbDFaMlkxQ2s5V1NVRk5NVkJUUVVoS2JFMVhUaTk1TVU1T1NuZHdNRE5SYzFsMmFsTk9jV2xFUWpKUVFUaEtZMU5TUW14V2RISTBkRFE0VWxsU2VpdFNZVFJ0V2xFS2IyVXJWSEJ4ZVZGNFJtMXhZelZKTTJ3dmNsUlBSMkpPY1doNE5ERnRMMXBuT0RsQllrZEdhV3QyUlRKVWN6Rk9kVlY0ZW5NMFYxVmpURXRXU2xsNlNBcEZibUpUWlZsaGNHUlFOMUl4WWpRMlJHNUJUblJSVm5jcmRUSjZRVk5IUVUxM1UyeFdkRlZqV2paUmRXUmhNMVl2U1dGbmFFNVhhVU5TTkVKRFdEUnFDbTQwUkVwWFNEWlVRVVF4VDFnM2VsQjVWMVF3YWpaSE56VnRkVXhSVVdGMlpDdG1UbEJ6Ym13dmFUaG9UbWxvTWtrdlZHcFFUbEE1VldjOVBRb3RMUzB0TFVWT1JDQkRSVkpVU1VaSlEwRlVSUzB0TFMwdENnPT0KICAgIHNlcnZlcjogaHR0cHM6Ly8xMC4yNTQuMC4xMgogIG5hbWU6IHNlbApjb250ZXh0czoKLSBjb250ZXh0OgogICAgY2x1c3RlcjogaW5mcmEKICAgIG5hbWVzcGFjZTogazI0LWJkawogICAgdXNlcjogaW5mcmEtYWRtaW4KICBuYW1lOiBpbmZyYQotIGNvbnRleHQ6CiAgICBjbHVzdGVyOiAiIgogICAgdXNlcjogIiIKICBuYW1lOiBwcm9kCi0gY29udGV4dDoKICAgIGNsdXN0ZXI6IHNlbAogICAgdXNlcjogc2VsLWFkbWluCiAgbmFtZTogc2VsCmN1cnJlbnQtY29udGV4dDogc2VsCmtpbmQ6IENvbmZpZwpwcmVmZXJlbmNlczoge30KdXNlcnM6Ci0gbmFtZTogaW5mcmEtYWRtaW4KICB1c2VyOgogICAgY2xpZW50LWNlcnRpZmljYXRlLWRhdGE6IExTMHRMUzFDUlVkSlRpQkRSVkpVU1VaSlEwRlVSUzB0TFMwdENrMUpTVU52ZWtORFFWbHpRME5SUkZJclN6Tm9ZWGcxUmxkNlFVNUNaMnR4YUd0cFJ6bDNNRUpCVVhOR1FVUkJVMDFTUVhkRVoxbEVWbEZSUkVSQlpISUtaRmRLYkV4WFRtaE5RalJZUkZSRk5FMUVSWGxPZWtFMVRVUkJNVTR4YjFoRVZGRXhUVVJaZUU1RVFUVk5SRUV4VGpGdmQwWlVSVlJOUWtWSFFURlZSUXBCZDNkTFlUTldhVnBUTVdoYVJ6RndZbXBEUTBGVFNYZEVVVmxLUzI5YVNXaDJZMDVCVVVWQ1FsRkJSR2RuUlZCQlJFTkRRVkZ2UTJkblJVSkJUMEZvQ2s5cGRHNXNUWFpETDBSd1lrUkhObGhOUm1Nd2JVRjNjVGgyTlc1R1FXSTBWRXRVUkZsNVJrcHlNVXhyWjFVdkswNDNiV2M1UkdoSWJFdFFNWG92TkdJS2VVdHJWMEl4ZHpKakwzTnBjRlJ1VDFFd1QxbENabWN2Vkd0Qk9YcE9jMFpETm1aVmVXdEVaSE5uZEdjM1NWRm1iVTQyWXpkQ1FtODBLMDlQTVUxclJnbzVNRGN4Yms1RFVGTmlZMkZNYnpaM2QxRkZiMkZzUlZkS1ZrMWxhSE5JUVRFNFZ6VkpRbU5PTDBKeWJGcFZRa3hPUVZwTGQweFljM2RNYzJaVFYyc3dDa1IxUkdsMVFuZEdWalExVkhReU9GVnNUazVRTkhjcmFuVjRVbEpUVkVGaU9GWmlXRWRIYlRsbFEyVlNOSFowTVhkRE5qUllUblJ6ZVc1YU9YcHNTMHNLUVRsSlN6UkZSVXcxWW0xT1NqWldkSFJXV2s1UGRUWXdjMmsyUlhsNlEzSlhNRzVpZFVGRGIxbGlSbGR3VEZsamJsaGxWbGxXTkhncllWUTBNbWgzU2dwSlMyWmpjME5XY0dVcmMxUkhMM0JPVURnd1EwRjNSVUZCVkVGT1FtZHJjV2hyYVVjNWR6QkNRVkZ6UmtGQlQwTkJVVVZCUkU1dmJYVXhjWGxxY0hkS0NuQklNV2gwWlVFcllpdFFOVzVGZUM4NVdqZFFlbkV4TWpjclJYbFZXV3AwU0d4WGRrUmFla1ZSTVRJMEsyWjBORzFRSzFsTWRURTNhVVZaWW1oUk1VOEtLM1pYYVZreGRFOUhVR3hGVVVVd1dHaEhXWFJXTUZSQmQxZHBWWGg1Y20xSVpXSnZPR2RzUTAxRVptcDZWa042WW5CaVMyVlZSV1ZaVjB4VlN6UjNlQXBRVjJrMVdGSk5SV2hQTTBSWFRtWmxNRTF0WmtWaVpXZHJjalpzYkV0SVUyZFRNak5ZT0U5RlRsWnhhMnhMVDFWTlQzUXpUa1J5Y0Roa1RqbDFTMGhrQ2tNeVlqazVZVFJxZVVWNlJ6VnZSM2hLZGtrMVZ5OVFaMDF4V1dkQkx6WllTRkI2WWtobVNIZ3ZhWFZWZEVselFXNXljMlZRU2tKTVRXMUNUMGt6ZWswS1RsZHJTWGhXUTFod01raFlaREp1TDJScFowSTBNMW96VFhCMGVHSXlaelpMTVZCNUsweHRNR2RaVTFWMlFUWmpUekJYY1hnM1ZUbHlReXRXZUZKSGVncGpVVlUwUmtjelFuQjNQVDBLTFMwdExTMUZUa1FnUTBWU1ZFbEdTVU5CVkVVdExTMHRMUW89CiAgICBjbGllbnQta2V5LWRhdGE6IExTMHRMUzFDUlVkSlRpQlNVMEVnVUZKSlZrRlVSU0JMUlZrdExTMHRMUXBOU1VsRmNGRkpRa0ZCUzBOQlVVVkJORU5GTmtzeVpWVjVPRXc0VDJ4elRXSndZM2RXZWxOWlJFTnllUzl0WTFWQ2RtaE5jRTFPYWtsVmJYWlZkVk5DQ2xRdk5ETjFZVVF3VDBWbFZXOHZXRkF2YUhaSmNWSlpTRmhFV25vcmVVdHNUMk0xUkZFMVowWXJSRGxQVVVRelRUSjNWVXh3T1ZSTFVVNHllVU15UkhNS2FFSXJXVE53ZW5ORlIycHFORFEzVlhsUldETlVkbGRqTUVrNVNuUjRiM1ZxY2tSQ1FWTm9jVlZTV1d4VmVEWkhkMk5FV0hoaWEyZEdkek00UjNWV2JBcFJSWE13UW10eVFYUmxla0YxZURsS1lWUlJUelJQU3pSSVFWWllhbXhQTTJKNFUxVXdNQzlxUkRaUE4wWkdSa3BOUW5aNFZuUmpXV0ZpTVRSS05VaHBDaXN6V0VGTWNtaGpNako2UzJSdU0wOVZiMjlFTUdkeVoxRlJkbXgxV1RCdWNGY3lNVlpyTURZM2NsTjVURzlVVEUxTGRHSlRaSFUwUVV0b2FITldZV3NLZEdoNVpHUTFWbWhZYWtnMWNGQnFZVWhCYTJkd09YbDNTbGRzTnpaNFRXSXJhekF2ZWxGSlJFRlJRVUpCYjBsQ1FWRkVabVpaUzBwdldVaHZTbEZvY1FwRlJIY3pWWEE0Y21Sb1FtWnZZbmR2U0doVlJWWnFabTB5T0ZwUVpsUkNUVlZtY2pSRWVVUXlRWGc1UkhReWVuRnBZMVJpVDBVeFFTOWxlR000VW1RMUNuaHlVa2hFWm5oWmRrcEVTRmREYW5CUGFtRTFPWHBCUjB4T1RqVkdlR1puTjAxamNtZEhOWEJJVFZSM1NVRmxUamd2UlU5bGRIQXJZVGN2ZHpNNVF6Y0tkVzF1VDJNd1dXaHdNMFpOV21VM1YwVlZlVU5wTkRoa1drWnZlRmxUZDFOc1UzcHVlbXBEZFdkVk9HbzVNRkl5TkRsRVIzRnRSMWhoVUdjMWRsUnFTQXBNWlVkVVVraEljWFJwTDJWeVowVm5OM2hNVTJWNVNXVk5RazVSTUZvNFUxRTBTakZVVGpOQlZEQnZMMFpsVmpKUFVFY3Zjbk42TDA0M2RGb3hORWxoQ21GcGJqZG1PV1JzZW5sMFVISTVLMFpsWVV4eldWSlhNWGhWWVdOck1VcFpaakZyTUhwQ1Z6bHJiR1J1ZUU0NVlqZGxkR0l5WTB4c1VtSjNMek5rUWxnS2NrWkNSMGxFTWtKQmIwZENRVkF5WnpST1VGWmpZM0IxT1N0VmJGTXpVRU52TTJZek5DODFiWEpvVW1ZeWVFeEpSbWgwTUhWYUsyazFXRFZzV0RjdmRncDVTVU5MVXpWVFpHNTVRblZEVTJSamQzZEtiMDVuYm5KNmJWUkJZMmgxYm5BNVNYTktRVXhUTW1KRGFVWk9ZMWhWWkU4clRVUlVNbFJaWW1GdlRFZDBDbmt5TmpWek0wZHJiM1ZQTmpaR2JYaENOa2d4YlhFd1lWZDJkbEJQT0RjM1NGQkNNVVJWZVVkdFUwRXJUR2x6VFc5dWR6UnNORVI0UVc5SFFrRlBTVFVLZGtveWJYZGtaall4VTNGWmVITXZURmxOVVdaS2VtRkxSVnB4YXpKbFNGbzVNR2RuVTBnMldFWjFUbkJtVVhKTE9UUkdWMk55TkdGd2NFUldNMlZOWWdwUGNtOHlhMUY0VDFGVGNtNW5lVlp2TkRSSlFrSnJla2xRU1dSTVJqQkpWbk5RVEROS1ZIWlphbkp5WjB0U2FXVTFhVU5ZWXpSR1lXdzFOMFJDVWpGR0NqaGxiRzQ0YXpFelRucEtRbXMyYmpOcVVsVlhlR1UwTlUxR1FteG1VSGhtYWpob2VURmxlV1JCYjBkQ1FVOVdjelpPVGxkaFpXVllaRGxEYkdGMGNHUUtVQ3RtWlhGcVVGQnBSSEpRT1hWcVNHSkNRVTFDTTIxaVRHZFBia05tVldsdU0yd3ZTVUl4WjJNM1ozWk5WVXRXUXpaWllYaElPRElyYlRGNlJrRldiUXBLUlRObVRtWm5SRFpZTVRWTlIySmtTbXg2YlRGek5tZ3ljMFpaT1ZSSGEzQTNaMU5pV0hOdlZsWjVlRVF3ZEVzNGVpdFVXSGRoYkVvMVdsQkJTMmRpQ25sVVRFOW1NbWQzTDFWVlNWZHNWVUY1WkRaaGFIQnVVa0Z2UjBKQlRXcDNlRGw1ZDJ4c1YyeGpNWEZYZDFkRmNFbFNZVlJLVmpKSldHZExhV3QyV0U0S2FWcDNSRTFQUm1kcGRrRk5ZbmRxTjBvNFZUSmhSWG8zYkhndmJrWXlVREprTnl0WVdVWmplREo1YVdzMGVGTkVhV3BIWW1ZeVJVMUxkR1I0YkRSTldBcHBWV3RIZUZsbVZ6TXhRMWRqTW5CMlIySkhlRlpQVGpnclJtZEpiV0UxWVhodWJYWXpjMVkwVFhkeWMzWkxRMjlTYVZOS1UyUTFSRFZsY0VSbGVsVm5Da2hNVEV4aVkwUjRRVzlIUVZCT1JYUXpjVkpTTkVWdWQxY3ZZakE0Wm5ObGVrOXhRVk16VUc1VlJDOHhhSEpUZGs0dk1YTlhhSEpzWkN0TlZubEJjbVlLWVd0NFREQkhibkZrY2xCdmExTkNOV0U1ZVU1TGNHMHpPWEZPV1ZaTEwzb3ZZMlEzTVdSM1dYazVOWEV5VVdKelltUjBWRVJ6TTJvemJTOXhOa1ZQVHdwWGVURTFWMFZJWjNOQlMySlNRVkkwUmpKQk5VSTBMM293U25GQ2RHMXNOM2RQT0ZNcmExa3hlVTFIZERCM05EQnlWbTFMZDJKblBRb3RMUzB0TFVWT1JDQlNVMEVnVUZKSlZrRlVSU0JMUlZrdExTMHRMUW89Ci0gbmFtZTogc2VsLWFkbWluCiAgdXNlcjoKICAgIGNsaWVudC1jZXJ0aWZpY2F0ZS1kYXRhOiBMUzB0TFMxQ1JVZEpUaUJEUlZKVVNVWkpRMEZVUlMwdExTMHRDazFKU1VOdmVrTkRRVmx6UTBOUlJIQlFLMFZCTnpFMVUwVlVRVTVDWjJ0eGFHdHBSemwzTUVKQlVYTkdRVVJCVTAxU1FYZEVaMWxFVmxGUlJFUkJaSElLWkZkS2JFeFhUbWhOUWpSWVJGUkZORTFFVFhkUFJFRTBUVVJGTVU1c2IxaEVWRkV4VFVSamVVNUVRVFJOUkVVeFRteHZkMFpVUlZSTlFrVkhRVEZWUlFwQmQzZExZVE5XYVZwVE1XaGFSekZ3WW1wRFEwRlRTWGRFVVZsS1MyOWFTV2gyWTA1QlVVVkNRbEZCUkdkblJWQkJSRU5EUVZGdlEyZG5SVUpCVDFwbkNtbzVTMlJaUTA1U1RsWnlaMUUxUzI1S2VsZ3JUbUkxT1dOTVEwTXJMMVp6SzFSNlIyVkdURGR5VlN0bFUxSXJRbFJrYUVScFVYRkpWWEZKTTFKV1ZYZ0tXRzVzTldab2VYaDZLemhYZURGU2NFaElkMlJpUTJOUlVrOVNLelZNYjJGd1Nub3ZhRVJCV0ZKcmRIRktjQ3QwWm01V1ZXZGFMMjFsYjBSNGVqQnpOZ3BMVVdFNVMzWk9TREUxTkhGS1JXTXphVlV3YzFKSlYwdFdkbU5UZFZkSVpTOU1Tblp4WkVkd1VuWmlMMVl3VWtkemJFdFpWblJOWjFoRmNsUnNiSFJrQ21wQllVSlBVR3RuU0ZGUlowTXhVbWxvWTJ0MlJqQlBabFYyT0VJdmFWWmljSFY2V0VSV1NYRlRMMkpGWTFwMUsxVklORGxzVUU1QmFtRkZZWHBGWmswS2FWVnRXamhpVkV3NE5XTTVkRll3ZDBsYVoxUjJXRkpwVVVwNE9XcEdZa1V5ZVdjeFRsTTBXVGxLVTBsdE1VYzROM0JRWXpscGVIZHZaRkk0TlZJNUt3cHlOSGxYYmtJNGRXRTVVeTlvYkdGNldYcHJRMEYzUlVGQlZFRk9RbWRyY1docmFVYzVkekJDUVZGelJrRkJUME5CVVVWQmIzaGhSMms0WkVkdVNpOXFDbk4zVUc5a1YzTTRRV2RaZW1aQlIwOHZlRTlUTUVoWlVuWnZWRXMwTWtGa09HSXZjMDlHUVhoUFREWmtOMGh5ZWtnM1RuVnJiME5YVUZCUUt6Um9OREVLUld0alQxbDVUMmhJZW05c2VHWk9iMUpCYm5BellsRXZTRVZtVTFOcFpsUk1SVTQ0VmtaT2RHeGFZVEZVU1daVFRVOTBRWFZoYVdoS2RWbE9LMk5UVXdwaWVVSnFPV2h5VWpKSGJEYzRTSE5ZTkdkNlMyVnhlbWhXWW1kUFlrUlRVVGh6Y0VWRU5uZzVSbWQzTUZsbE5GTTVaamxSWmxkWGFrUXJWbWhFUTA5SkNsRlBOWFJKVDBGTk9YZERkRlpTWldkeFEzaEdSM1pIUzJselJISjBSVmxxUW1oTWRtRjJLMXBVVUROeWRXMDRTMDgwVmxSeVdXYzFlVWMyWVZWT00zWUtlbGN5ZEZvd1dFVkNLMlZzUm5wNVdEQkxRbU5EV2xGQlNreFdNamN5UjNCb0wzQkRkRTkwYWtWbmNHNXhaa1paWkZjd2J6SkdTbHBQV21oQksxZDZkZ3B6VGt3eVptbG9aRFJSUFQwS0xTMHRMUzFGVGtRZ1EwVlNWRWxHU1VOQlZFVXRMUzB0TFFvPQogICAgY2xpZW50LWtleS1kYXRhOiBMUzB0TFMxQ1JVZEpUaUJTVTBFZ1VGSkpWa0ZVUlNCTFJWa3RMUzB0TFFwTlNVbEZiM2RKUWtGQlMwTkJVVVZCTlcxRFVEQndNV2RKTVVVeFYzVkNSR3R4WTI1T1pqUXhkbTR4ZDNOSlREYzVWM28xVUUxYU5GVjJkWFJVTlRWS0NrZzBSazR5UlU5S1EyOW9VMjlxWkVaV1ZFWmxaVmhzSzBoTVNGQTNlR0pJVmtkclkyWkNNWE5LZUVKRk5VZzNhM1ZvY1d0dVVDdEZUVUprUjFNeWIyMEtiall4SzJSV1UwSnVLMW8yWjFCSVVGTjZiM0JDY2pCeE9EQm1XRzVwYjJ0U2VtVktWRk40UldoWmNGYzVlRXMxV1dRM09ITnRLM0F3WVd4SE9YWTVXQXBTUldGNVZYQm9WekI1UW1OVGRFOVhWekV5VFVKdlJUUXJVMEZrUWtOQlRGWkhTMFo1VXpoWVVUVTVVeTkzU0N0S1ZuVnROMDVqVGxWcGNFdzVjMUo0Q20wM05WRm1hakpWT0RCRFRtOVNjazFTT0hsS1UxcHVlSFJOZG5wc2VqSXhXRlJCYUcxQ1R6bGtSMHBCYmtneVRWWnpWR0pMUkZVeFRHaHFNR3hKYVdJS1ZXSjZkV3M1ZWpKTVNFTm9NVWg2YkVnek5uWnFTbUZqU0hrMWNqRk1LMGRXY2s1cVQxRkpSRUZSUVVKQmIwbENRVU52WjFocGVGWlBjemcyWld4amVncDVlV1F5UTFkWFIwcHhNaXR2YlhscmFIYzFTamQzYkN0QlYwdHlVWFpZWTBzclRHMDRhVlZ3ZEVaWFNYVkNUMUp3T0hZNFUzaHdUR0pTVVhsTU5rODBDblJ3Y0c4emFIbFZRazFNWmpWeWEyaDFlRWROTjJFd1NIcEdVU3MzVlhVNVJGaE5SbVJ4Y0dReVdsbDZkbmhNTVVwTlRFMTZPVTgzYnpZM05EVkRVek1LT0VGd1ZucFlWMlpOY1dnMGN6UTFZV3BwZFc1aGRUTXlTRlZsU2trckwwdHlSVzUwUWxOd04wSnhTVGw2U1dOMmVsRlViamhxTURkMWFFVTRWRXhzVlFwS00wVm1VbkJMYmxSVFptNTNMekZRVEdoYVMyTndXRGxvSzFrd2NYWkpRemRPUkhONlJHZEhUVXM0UmxsQk1YbENabXBGVTJKelZDdFNkMHBwWmpFeENqWmFSVlpTT1dGTVJGcDFiRlpKWkZSTFIxZG1kbVZuZWt0YVJrNWxiSGhxV0VaUmJuVnllRUZXVkRGYU1FMUNUV05TUmxWcVZYQnNjRVpSTWtOVVJ6a0tZMnBUYkdSVlJVTm5XVVZCT0RseGVteFJXVzlsWmpoT2RXcEJhMk4wV2tkeFpUSlVhalJDTDJ0U1kyeFhOM0JqU21OVlFUUnFaRFJaYm10NE0wZHdNUXBsY0ZWdFFWQXZlbFJrTmxCNlEyWm1jbWxYTlVKTE1qTTRaekpCVTAxTmFIUklWU3RHTDBwMVdrdDNOMDFtTVhNd1N6Vk5RMnhHTlRaNk9FZFpNRzltQ25oemVsZ3plVU5wWjBSNk9WaEdPR3hLV21GaU1FeFBaUzlaY0VWblNFUnhNVlZMVlZSWGNGWjFhbmgwUkZGaGVHYzRRVlZGYkUxRFoxbEZRVGhrYjBVS2QwSm1OME5RTDAxcVlXZEZTa05NZHl0c1pETmtiVFV6WVhOU2VrYzNNekJoWnk5QlNtMDNiR2xST0Vad1lVOUdSamhvYzBwUkt5ODFOMUIxTlZsVVJncFhRVFpaVlRWTFlsVjVXVFJSWW5OUk9HWTNSa1V4ZVhkRk1YTTBlV0ZrT1ZkTU16QlViVk5rTVZoMU1GbHNiR2hOWjNCRWRWUlpTV3hvV0dVeVZXVk9DbFZHUXk5RVFWTlVkVzV2TUVORWFtOUxaVXg1Ym1GRGJrZHpSVW8wY0VoRFJFaFRaa2R6VFVObldVSlNPRTR5UkdGQmVGWTBhbE13Y1dSVE1XMW1ZMjhLZUhGS1pFTkRjbFpyUm1WSVYxUnVOVzU0WkVzM1MxUlNVV3BTVmtGd2FucFdaMkowVFhoVFNYbEJOamsxV0VGMVZIQkxOMVppZVVnME5qSkdlR0ozWmdweVdETjFRV2hNUTFaWVYxZDFUR1pHTnpaMWVHc3JkRW81TWxkdlJ6VktUamxUZEdNeVRsTkRSSFo0TnlzMlV6VXljMEZHUVhwaFluSTRhVkVyUjBOUkNuaE5lV055ZFhsaWNHYzFiVFJEWW5GU1RFdzFOMUZMUW1kRGFteFlkWGhGYjJSU2VIWk9jM1pWUWxBd1VFbzVOR0oxUkRrMlVDdExNMHBSVTFkUFVXVUtZV0pYVjBKM1dsbElaa3BYV210clVsRlJaemRWTkRSUmNGSk1NbXR3UWtSV05IRTJVR0l5Wm5SMEsxZHFSbFF2WVdJdlQyRnZLemRYZVhwMVVEUnVhd3BDVVRORloyUlFOWEZTVlVGWVEydHJRbnBQYjJGWFpFaHdNMnhEVjJscU9HNXVSMlo2U1UwMU5uUmhRa2RRUlUxVFZUVlRVR2tyVGl0UFpuaEZZMnRrQ2xveFNWWkJiMGRDUVU5dVNVaFJSbTEyV0V0clYyRnRXVUpHZVRJellVVnBMelV4WlhGMFVXaG5VelZZWWtSdmVtTXJTRzAzUzBSamFsTlVhamRMY1hjS2VETlBXV1l2YmtwSVUydFhXR1l5WkRkU2RqbGthVzA1ZUVNM1NuUjVSVUZMVUhodk9YRklTV1ZRTWtGamNGVnliaXRMVVU5NFFsaG5PVVZWV0dvMFlRb3JXWE13VjBwRE5HbEVjVTFwVmtOMllqSkJNMmhCV1ZoQ1p6aEdZbVF6Ym1ocU5VbDJURU5PVWk5WGRVTkRUVTVOTTNVeENpMHRMUzB0UlU1RUlGSlRRU0JRVWtsV1FWUkZJRXRGV1MwdExTMHRDZz09Cg==
  GIT_BRANCH: ${CI_COMMIT_BRANCH}
  GIT_TAG: ${CI_COMMIT_TAG}

stages:
  - build
  - deploy

.docker_support:
  variables:
    DOCKER_DRIVER: overlay2
    DOCKER_HOST: tcp://localhost:2375
  services:
    - name: docker:18.09.7-dind
      entrypoint:
        - /bin/sh
        - -c
        - dockerd-entrypoint.sh --insecure-registry nexus.itecos.com:5001 --insecure-registry registry.sel.itecos.com:5001 || exit

.install_kubectl: &install_kubectl
  - mkdir -p /root/.kube
  - echo -n $KUBE_CONFIG | base64 -d > /root/.kube/config

orcTelegramBot:build:
  image: nexus.itecos.com:5000/sbt-docker-build-13:0.1
  stage: build
  extends: .docker_support
  before_script:
    - git branch
  script:
    - sbt "project orcTelegramBot" docker:publish

orcTelegramBot:deploy:
  image: nexus.itecos.com:5000/google/cloud-sdk:284.0.0
  when: manual
  stage: deploy
  extends: .docker_support
  before_script:
    - *install_kubectl
    - kubectl config use-context sel
  script:
    - docker pull nexus.itecos.com:5001/kvp24/orc-telegram-bot:${GIT_TAG}
    - docker tag nexus.itecos.com:5001/kvp24/orc-telegram-bot:${GIT_TAG} registry.sel.itecos.com:5000/kvp24/orc-telegram-bot:${GIT_TAG}
    - docker push registry.sel.itecos.com:5000/kvp24/orc-telegram-bot:${GIT_TAG}
    - kubectl -n ${PROD_NAMESPACE} set image deployment/orc-telegram-bot orc-telegram-bot=registry.sel.itecos.com:5000/kvp24/orc-telegram-bot:${GIT_TAG}